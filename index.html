<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙŠØ§Ø¯ RPG ÙˆØ§Ù‚Ø¹ÙŠ</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
:root {--bg:#000; --panel:#0b0f0c; --text:#9effa1; --accent:#52ffa3;}
body{margin:0;font-family:system-ui,Segoe UI,Roboto,Tahoma,Arial;background:var(--bg);color:var(--text);}
header{padding:16px;text-align:center;background:linear-gradient(90deg,#071,transparent,#071);position:fixed;top:0;width:100%;z-index:5}
.container{padding:80px 12px 12px;max-width:980px;margin:auto}
.tabs{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-bottom:12px}
.tab-btn{padding:10px;border:1px solid #104e2d;background:#08140e;color:var(--text);border-radius:12px;cursor:pointer}
.tab-btn.active{outline:2px solid var(--accent);}
.panel{background:#0b0f0c;border-radius:14px;padding:12px;margin-bottom:12px}
.row{display:flex;gap:10px;flex-wrap:wrap}
.card{background:#0f1511;border-radius:12px;padding:12px;flex:1;min-width:220px}
.btn{background:#0a311b;color:var(--text);border-radius:10px;padding:8px 12px;cursor:pointer}
.btn:disabled{opacity:.5;cursor:default}
#map{height:360px;border-radius:12px;border:1px solid #124}
.footer{text-align:center;opacity:.7;font-size:12px;margin:12px 0}
</style>
</head>
<body>
<header><h1>ğŸ“œ Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙŠØ§Ø¯ RPG ÙˆØ§Ù‚Ø¹ÙŠ</h1></header>
<div class="container">

<div class="tabs" role="tablist">
  <button class="tab-btn active" data-tab="status">âš”ï¸ Ø§Ù„Ø­Ø§Ù„Ø©</button>
  <button class="tab-btn" data-tab="quests">ğŸ¯ Ø§Ù„Ù…Ù‡Ø§Ù…</button>
  <button class="tab-btn" data-tab="inventory">ğŸ’ Ø§Ù„Ø¬Ø±Ø¯</button>
  <button class="tab-btn" data-tab="log">ğŸ“˜ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
  <button class="tab-btn" data-tab="map">ğŸ—ºï¸ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</button>
</div>

<section id="tab-status" class="panel">
  <div class="row">
    <div class="card">
      <h3>Ø§Ù„Ù…Ø³ØªÙˆÙ‰ <span id="level">1</span></h3>
      <p>HP: <span id="hp">100</span> | MP: <span id="mp">100</span></p>
      <p>âš”ï¸ ATK: <span id="atk">10</span> | ğŸ›¡ï¸ DEF: <span id="def">5</span></p>
    </div>
  </div>
</section>

<section id="tab-quests" class="panel">
  <div id="questsList" class="row"></div>
</section>

<section id="tab-inventory" class="panel" hidden>
  <h3>Ø§Ù„Ø¬Ø±Ø¯:</h3>
  <div id="inventoryItems"></div>
</section>

<section id="tab-log" class="panel" hidden>
  <div id="log">ğŸ”” Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¨Ø¹Ø¯.</div>
</section>

<section id="tab-map" class="panel" hidden>
  <div id="map"></div>
</section>

<p class="footer">âš’ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ± â€“ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±: 1x_x.issam.x_x5</p>
</div>

<script>
// Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
document.querySelectorAll(".tab-btn").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".tab-btn").forEach(x=>x.classList.remove("active"));
    btn.classList.add("active");
    document.querySelectorAll("section[id^='tab-']").forEach(s=>s.hidden=true);
    document.getElementById("tab-"+btn.dataset.tab).hidden=false;
    if(btn.dataset.tab==="map"){ setTimeout(()=>map.invalidateSize(),200); }
  });
});

// Leaflet map
let map = L.map('map').setView([36.75, 3.05], 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom:19}).addTo(map);
let pathLine = L.polyline([], {color:'#1aff8c'}).addTo(map);

// Ø§Ù„Ø­Ø§Ù„Ø©
function updateStat(id,value){document.getElementById(id).textContent=value;}
function applyRewards(rewards){
  let hp = parseInt(document.getElementById("hp").textContent);
  let mp = parseInt(document.getElementById("mp").textContent);
  let atk = parseInt(document.getElementById("atk").textContent);
  let def = parseInt(document.getElementById("def").textContent);
  if(rewards.HP) hp+=rewards.HP;
  if(rewards.MP) mp+=rewards.MP;
  if(rewards.ATK) atk+=rewards.ATK;
  if(rewards.DEF) def+=rewards.DEF;
  updateStat("hp",hp); updateStat("mp",mp);
  updateStat("atk",atk); updateStat("def",def);
  if(rewards.items){
    const inv = document.getElementById("inventoryItems");
    rewards.items.forEach(it=>{const p=document.createElement("p");p.textContent="ğŸ“¦ "+it;inv.appendChild(p);});
  }
}

// Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªØ³Ù„Ø³Ù„Ø© ÙˆØ§Ù„Ù…ØªÙ†ÙˆØ¹Ø©
const quests = [
  {name:"Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø©", type:"location", lat:36.751, lon:3.055, radius:0.05, exp:20, rewards:{HP:5}, unlocked:true},
  {name:"Ø§ØµØ·ÙŠØ§Ø¯ ÙˆØ­Ø´ Ø§Ù„ØºØ§Ø¨Ø©", type:"action", steps:3, exp:50, rewards:{ATK:2, items:["Ø¬Ù„Ø¯ Ø§Ù„ÙˆØ­Ø´"]}, unlocked:false},
  {name:"Ø´Ø±Ø¨ ÙƒÙˆØ¨ Ù…Ø§Ø¡", type:"timer", duration:5000, exp:10, rewards:{HP:5}, unlocked:false},
  {name:"Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø¬Ø¨Ù„", type:"location", lat:36.755, lon:3.060, radius:0.05, exp:40, rewards:{MP:10}, unlocked:false}
];

function renderQuests(){
  const container=document.getElementById("questsList"); container.innerHTML="";
  quests.forEach((q,i)=>{
    if(!q.unlocked) return;
    const card=document.createElement("div"); card.className="card";
    if(q.type==="location"){
      card.innerHTML=`<h3>${q.name}</h3><p>Ù†ÙˆØ¹: Ù…ÙˆÙ‚Ø¹ | EXP: ${q.exp}</p>
      <button id="completeBtn${i}" class="btn" disabled onclick="completeQuest(${i})">âœ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ù…Ù‡Ù…Ø©</button>
      <button class="btn" onclick="startLocationTask(${i})">ğŸ“ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ù‡Ù…Ø©</button>`;
    } else if(q.type==="action"){
      card.innerHTML=`<h3>${q.name}</h3><p>Ù†ÙˆØ¹: Ù†Ø´Ø§Ø· | EXP: ${q.exp}</p>
      <button id="completeBtn${i}" class="btn" disabled onclick="completeQuest(${i})">âœ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ù…Ù‡Ù…Ø©</button>
      <button class="btn" onclick="startActionTask(${i})">âš”ï¸ Ù†ÙØ° Ø§Ù„Ù…Ù‡Ù…Ø©</button>`;
    } else if(q.type==="timer"){
      card.innerHTML=`<h3>${q.name}</h3><p>Ù†ÙˆØ¹: ÙˆÙ‚Øª | EXP: ${q.exp}</p>
      <button id="completeBtn${i}" class="btn" disabled onclick="completeQuest(${i})">âœ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ù…Ù‡Ù…Ø©</button>
      <button class="btn" onclick="startTimerTask(${i})">â±ï¸ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ù‡Ù…Ø©</button>`;
    }
    container.appendChild(card);
  });
}

// Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹
function startLocationTask(i){
  const q = quests[i];
  alert("ğŸ“ Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ù…Ù‡Ù…Ø©.");
  const watchId = navigator.geolocation.watchPosition(pos=>{
    const userLat=pos.coords.latitude;
    const userLon=pos.coords.longitude;
    const distance=Math.sqrt(Math.pow(userLat-q.lat,2)+Math.pow(userLon-q.lon,2));
    if(distance<q.radius){
      navigator.geolocation.clearWatch(watchId);
      document.getElementById(`completeBtn${i}`).disabled=false;
      L.circleMarker([q.lat,q.lon],{radius:6,color:"#1aff8c"}).addTo(map);
      alert("ğŸ‰ ÙˆØµÙ„Øª Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ù…Ù‡Ù…Ø©.");
    }
  }, err=>{alert("âŒ Ù„Ù… Ø£Ø³ØªØ·Ø¹ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹Ùƒ: "+err.message);});
}

// Ù…Ù‡Ø§Ù… Ø§Ù„Ù†Ø´Ø§Ø·
function startActionTask(i){
  const q=quests[i]; q.progress=0;
  alert("âš”ï¸ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± ØªÙ†ÙÙŠØ° 3 Ù…Ø±Ø§Øª Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ù…Ù‡Ù…Ø©.");
  const interval=setInterval(()=>{
    q.progress++; 
    if(q.progress>=q.steps){ clearInterval(interval); document.getElementById(`completeBtn${i}`).disabled=false; alert("âœ… Ø§Ù„Ù…Ù‡Ù…Ø© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¥ØªÙ…Ø§Ù…!"); }
  }, 1000);
}

// Ù…Ù‡Ø§Ù… Ø§Ù„ÙˆÙ‚Øª
function startTimerTask(i){
  const q=quests[i];
  alert("â±ï¸ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ø¯Ø£ØªØŒ Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ ØªÙ†ØªÙ‡ÙŠ...");
  setTimeout(()=>{document.getElementById(`completeBtn${i}`).disabled=false; alert("âœ… ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ù…Ù‡Ù…Ø©!");}, q.duration);
}

// Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ù…Ù‡Ù…Ø© ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ§Ù„ÙŠØ©
function completeQuest(i){
  const q=quests[i]; applyRewards(q.rewards);
  alert(`ğŸ‰ ØªÙ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ù…Ù‡Ù…Ø© "${q.name}"!`);
  window.totalExp=(window.totalExp||0)+q.exp;
  let lvl=parseInt(document.getElementById("level").textContent);
  if(window.totalExp>=100){ lvl++; window.totalExp-=100; updateStat("level",lvl); alert(`ğŸ‰ Ø§Ø±ØªÙ‚ÙŠØª Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${lvl}!`);}
  if(i+1<quests.length){ quests[i+1].unlocked=true; renderQuests(); }
}

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ù‡Ø§Ù…
renderQuests();
</script>
</body>
</html>
